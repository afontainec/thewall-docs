<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Overview | Chinchay Docs</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="">
    <link rel="preload" href="/assets/css/0.styles.ab30e0ca.css" as="style"><link rel="preload" href="/assets/js/app.2773cf3e.js" as="script"><link rel="preload" href="/assets/js/2.3f720234.js" as="script"><link rel="preload" href="/assets/js/9.0aa8bee1.js" as="script"><link rel="prefetch" href="/assets/js/10.1edc54dd.js"><link rel="prefetch" href="/assets/js/11.2f00b1d8.js"><link rel="prefetch" href="/assets/js/12.1f05b6b4.js"><link rel="prefetch" href="/assets/js/13.c98ba095.js"><link rel="prefetch" href="/assets/js/14.1b2b2c75.js"><link rel="prefetch" href="/assets/js/15.702d946e.js"><link rel="prefetch" href="/assets/js/16.a41c1694.js"><link rel="prefetch" href="/assets/js/17.335d4649.js"><link rel="prefetch" href="/assets/js/18.23ce0973.js"><link rel="prefetch" href="/assets/js/19.aa8171a6.js"><link rel="prefetch" href="/assets/js/20.fcee7802.js"><link rel="prefetch" href="/assets/js/21.84451ad4.js"><link rel="prefetch" href="/assets/js/22.ca5d3982.js"><link rel="prefetch" href="/assets/js/23.d5279137.js"><link rel="prefetch" href="/assets/js/24.41953457.js"><link rel="prefetch" href="/assets/js/25.6f8b54bd.js"><link rel="prefetch" href="/assets/js/26.9965863d.js"><link rel="prefetch" href="/assets/js/27.5c297913.js"><link rel="prefetch" href="/assets/js/28.cc8160a1.js"><link rel="prefetch" href="/assets/js/29.3a7bb5f9.js"><link rel="prefetch" href="/assets/js/3.6a2b7fa3.js"><link rel="prefetch" href="/assets/js/30.42d9cb16.js"><link rel="prefetch" href="/assets/js/31.071fae85.js"><link rel="prefetch" href="/assets/js/32.9325ffa2.js"><link rel="prefetch" href="/assets/js/33.4af5988e.js"><link rel="prefetch" href="/assets/js/34.c865156d.js"><link rel="prefetch" href="/assets/js/35.d3ce8ef4.js"><link rel="prefetch" href="/assets/js/36.11f74532.js"><link rel="prefetch" href="/assets/js/4.1b09c2c5.js"><link rel="prefetch" href="/assets/js/5.5c4c1fbb.js"><link rel="prefetch" href="/assets/js/6.b0461825.js"><link rel="prefetch" href="/assets/js/7.3211b211.js"><link rel="prefetch" href="/assets/js/8.a7dcf5bf.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ab30e0ca.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Chinchay Docs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/gettingstarted/" class="nav-link">
  Getting Started
</a></div><div class="nav-item"><a href="/docs/" class="nav-link router-link-active">
  Docs
</a></div><div class="nav-item"><a href="/models/" class="nav-link">
  The Model
</a></div><div class="nav-item"><a href="/middleware/" class="nav-link">
  Middleware
</a></div><div class="nav-item"><a href="/errorhandler/" class="nav-link">
  Error Handler
</a></div><div class="nav-item"><a href="/collaborate/" class="nav-link">
  Collaborate!
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/gettingstarted/" class="nav-link">
  Getting Started
</a></div><div class="nav-item"><a href="/docs/" class="nav-link router-link-active">
  Docs
</a></div><div class="nav-item"><a href="/models/" class="nav-link">
  The Model
</a></div><div class="nav-item"><a href="/middleware/" class="nav-link">
  Middleware
</a></div><div class="nav-item"><a href="/errorhandler/" class="nav-link">
  Error Handler
</a></div><div class="nav-item"><a href="/collaborate/" class="nav-link">
  Collaborate!
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/docs/overview.html" class="sidebar-link">Overview: What is Chinchay?</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/overview.html#overview-what-is-chinchay" class="sidebar-link">Overview: What is Chinchay?</a></li><li class="sidebar-sub-header"><a href="/docs/overview.html#file-structure-model-view-controller-mvc-architecture" class="sidebar-link">File Structure: Model-View-Controller (MVC) Architecture</a></li><li class="sidebar-sub-header"><a href="/docs/overview.html#updating-the-database" class="sidebar-link">Updating the Database</a></li><li class="sidebar-sub-header"><a href="/docs/overview.html#rest-api" class="sidebar-link">REST API</a></li></ul></li><li><a href="/docs/cli.html" aria-current="page" class="active sidebar-link">Command Line Interface</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/cli.html#overview" class="sidebar-link">Overview</a></li><li class="sidebar-sub-header"><a href="/docs/cli.html#the-magical-new-command" class="sidebar-link">The magical new command</a></li><li class="sidebar-sub-header"><a href="/docs/cli.html#chinchay-configurations-chainfile" class="sidebar-link">Chinchay Configurations: Chainfile</a></li><li class="sidebar-sub-header"><a href="/docs/cli.html#what-is-created" class="sidebar-link">What is created?</a></li><li class="sidebar-sub-header"><a href="/docs/cli.html#frontend-and-backend" class="sidebar-link">frontend and backend</a></li><li class="sidebar-sub-header"><a href="/docs/cli.html#the-middleware-flag" class="sidebar-link">the middleware flag</a></li><li class="sidebar-sub-header"><a href="/docs/cli.html#do-i-prefer-camels-or-snakes" class="sidebar-link">Do I prefer üê´camels or üêçsnakes?</a></li></ul></li><li><a href="/docs/chainfile.html" class="sidebar-link">Chainfile</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/chainfile.html#overview" class="sidebar-link">Overview</a></li><li class="sidebar-sub-header"><a href="/docs/chainfile.html#knex-the-minimal-configuration" class="sidebar-link">Knex: The minimal Configuration</a></li><li class="sidebar-sub-header"><a href="/docs/chainfile.html#model-controller-routes" class="sidebar-link">Model + Controller + Routes</a></li><li class="sidebar-sub-header"><a href="/docs/chainfile.html#views" class="sidebar-link">views</a></li><li class="sidebar-sub-header"><a href="/docs/chainfile.html#frontend" class="sidebar-link">frontend</a></li><li class="sidebar-sub-header"><a href="/docs/chainfile.html#backend" class="sidebar-link">backend</a></li><li class="sidebar-sub-header"><a href="/docs/chainfile.html#middleware-access-thewall" class="sidebar-link">middleware + access + TheWall</a></li></ul></li><li><a href="/docs/hateoas.html" class="sidebar-link">Hateoas Generator</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/hateoas.html#overview" class="sidebar-link">Overview</a></li><li class="sidebar-sub-header"><a href="/docs/hateoas.html#hateoas-generator" class="sidebar-link">HATEOAS Generator</a></li><li class="sidebar-sub-header"><a href="/docs/hateoas.html#addlink" class="sidebar-link">addLink</a></li><li class="sidebar-sub-header"><a href="/docs/hateoas.html#get" class="sidebar-link">get</a></li><li class="sidebar-sub-header"><a href="/docs/hateoas.html#removelink" class="sidebar-link">removeLink</a></li></ul></li><li><a href="/docs/model.html" class="sidebar-link">The TableGateway Model</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/model.html#overview" class="sidebar-link">Overview</a></li><li class="sidebar-sub-header"><a href="/docs/model.html#table-data-gateway" class="sidebar-link">Table Data Gateway</a></li></ul></li><li><a href="/docs/middleware.html" class="sidebar-link">Chinchay Middleware</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/middleware.html#overview" class="sidebar-link">Overview</a></li></ul></li><li><a href="/docs/errorhandler.html" class="sidebar-link">Error Handler: Manage http responses</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/errorhandler.html#overview" class="sidebar-link">Overview</a></li></ul></li><li><a href="/docs/clientside.html" class="sidebar-link">API: Client Querying</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/clientside.html#overview" class="sidebar-link">Overview</a></li><li class="sidebar-sub-header"><a href="/docs/clientside.html#create" class="sidebar-link">Create</a></li><li class="sidebar-sub-header"><a href="/docs/clientside.html#update" class="sidebar-link">Update</a></li><li class="sidebar-sub-header"><a href="/docs/clientside.html#delete" class="sidebar-link">Delete</a></li><li class="sidebar-sub-header"><a href="/docs/clientside.html#find-by-id" class="sidebar-link">Find by ID</a></li><li class="sidebar-sub-header"><a href="/docs/clientside.html#find" class="sidebar-link">Find</a></li><li class="sidebar-sub-header"><a href="/docs/clientside.html#count" class="sidebar-link">Count</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="overview"><a href="#overview" class="header-anchor">#</a> Overview</h2> <p>Chinchay offers a command line to help you get started. It will auto-generate the files you need to develop. So go ahead at take a look:</p> <h2 id="the-magical-new-command"><a href="#the-magical-new-command" class="header-anchor">#</a> The magical new command</h2> <p>Most of Chinchay's magic happens with a simple:</p> <div class="language- extra-class"><pre class="language-text"><code>$ chinchay new relation
</code></pre></div><p>This simple, but yet powerful, command will create all that is needed to create, read, update and delete entries to the <em>relation</em>. The keyword <em>relation</em> corresponds to what are you building, for instance in the <a href="../gettingstarted">getting started tutorial</a> they are creating coffees therefore the command was:</p> <div class="language- extra-class"><pre class="language-text"><code>$ chinchay new coffee
</code></pre></div><h2 id="chinchay-configurations-chainfile"><a href="#chinchay-configurations-chainfile" class="header-anchor">#</a> Chinchay Configurations: Chainfile</h2> <p>All of the configurations needed will be in a file called .chainfile.js on the base of the repository. So before we go on we will explain the minimum chainfile needed for the new command to operate. For more information on the chainfile, visit the <a href="./chainfile">chainfile documentation</a></p> <h3 id="the-minimal-chainfile"><a href="#the-minimal-chainfile" class="header-anchor">#</a> The minimal chainfile</h3> <p>The minimal chainfile needed by Chinchay is one that indicates where the <a href="http://knexjs.org/" target="_blank" rel="noopener noreferrer">knex<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> instance is. So it should look something like this:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  knex<span class="token operator">:</span>  path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'knex.js'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Where the knex.js file exports the knex instance. Check the <a href="/gettingstarted/ejs.html#connecting-to-the-database">Getting started tutorial</a>, there you can see an example of a knex.js file.</p> <h2 id="what-is-created"><a href="#what-is-created" class="header-anchor">#</a> What is created?</h2> <p>So now that we have our minimal chainfile, what is actually being created? It will create a knex migration, a model, a controller, views, and some routes.</p> <div class="custom-block tip"><p class="custom-block-title">DISCLAIMER</p> <p>Depending on how the chainfile is defined, the files created might vary.</p></div> <h3 id="knex-migration"><a href="#knex-migration" class="header-anchor">#</a> Knex migration</h3> <p>Well everything starts with the database. So a migration to add the new table is created. If by this point you're a thinking database, table, knex, migration? WTF are those? don't worry check the explanation <a href="/docs/overview.html#updating-the-database">here</a>.</p> <p>The migration should look like something like this:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>exports<span class="token punctuation">.</span><span class="token function-variable function">up</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">knex</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> knex<span class="token punctuation">.</span>schema<span class="token punctuation">.</span><span class="token function">createTable</span><span class="token punctuation">(</span><span class="token string">'coffee'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">table</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Incremental id</span>
    table<span class="token punctuation">.</span><span class="token function">increments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// created_at and updated_at</span>
    table<span class="token punctuation">.</span><span class="token function">timestamps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span><span class="token function-variable function">down</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">knex</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> knex<span class="token punctuation">.</span>schema<span class="token punctuation">.</span><span class="token function">dropTable</span><span class="token punctuation">(</span><span class="token string">'coffee'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Let's explain every bit, we are creating a table called coffee, in this case the relation was named coffee, if we would have run <code>chinchay new tea</code> the table would have been called tea. the <code>table.increments()</code> add an id column that will auto-increment and <code>table.timestamps()</code> adds a created_at and updated_at columns. So far the table is something like this:</p> <table><thead><tr><th>Column</th> <th>Type</th> <th>Collation</th> <th>Nullable</th> <th>Default</th></tr></thead> <tbody><tr><td>id</td> <td>integer</td> <td></td> <td>not null</td> <td>nextval('coffee_id_seq'::regclass)</td></tr> <tr><td>created_at</td> <td>timestamp with time zone</td> <td></td> <td></td> <td></td></tr> <tr><td>updated_at</td> <td>timestamp with time zone</td> <td></td> <td></td> <td></td></tr></tbody></table> <p>So you must edit this file to add the columns you desire:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>exports<span class="token punctuation">.</span><span class="token function-variable function">up</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">knex</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> knex<span class="token punctuation">.</span>schema<span class="token punctuation">.</span><span class="token function">createTable</span><span class="token punctuation">(</span><span class="token string">'coffee'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">table</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Incremental id</span>
    table<span class="token punctuation">.</span><span class="token function">increments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    table<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">notNullable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    table<span class="token punctuation">.</span><span class="token function">integer</span><span class="token punctuation">(</span><span class="token string">'price'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// created_at and updated_at</span>
    table<span class="token punctuation">.</span><span class="token function">timestamps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span><span class="token function-variable function">down</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">knex</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> knex<span class="token punctuation">.</span>schema<span class="token punctuation">.</span><span class="token function">dropTable</span><span class="token punctuation">(</span><span class="token string">'coffee'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>For a complete guide on how to add columns visit the <a href="http://knexjs.org/#Schema-createTable" target="_blank" rel="noopener noreferrer">knex documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Don't forget to run:</p> <div class="language- extra-class"><pre class="language-text"><code>$ knex migrate:latest
</code></pre></div><p>For the migration to be taken into account!</p> <h4 id="where-it-s-created-and-why-there"><a href="#where-it-s-created-and-why-there" class="header-anchor">#</a> Where it's created and why there?</h4> <p>On the chainfile we defined where the knex instance is. The knex will have its own configuration on where it should create the migration. So it's up to knex to decide where the file is created!</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <ol><li>For the knex configuration we recommend having a <a href="http://knexjs.org/#knexfile" target="_blank" rel="noopener noreferrer">knexfile<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, it's cleaner and more elegant!</li> <li>I usually have a db directory in the root, where all the database thingies are.</li></ol></div> <h3 id="the-model"><a href="#the-model" class="header-anchor">#</a> The Model</h3> <p>The model is the one responsible for interacting with the table created by the knex migration. It is very simple and it should look like this:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> Table <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'chinchay'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token keyword">class</span> <span class="token class-name">Coffee</span> <span class="token keyword">extends</span> <span class="token class-name">Table</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> tableName <span class="token operator">=</span> <span class="token string">'coffee'</span><span class="token punctuation">;</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>tableName<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Coffee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


module<span class="token punctuation">.</span>exports <span class="token operator">=</span> instance<span class="token punctuation">;</span>

</code></pre></div><p>As you may notice this is a <a href="https://www.dofactory.com/javascript/design-patterns/singleton?s=40" target="_blank" rel="noopener noreferrer">singleton<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> (there will only be one instance of the Coffee class). This class extends the Table class from Chinchay, which has all the basic methods you need to get started. But if you need more, feel free to add more methods to the Coffee class. For more information on this, <a href="./model">click here</a>.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>The tableName must match with the table created in the migration!</p></div> <h4 id="where-it-s-created-and-why-there-2"><a href="#where-it-s-created-and-why-there-2" class="header-anchor">#</a> Where it's created and why there?</h4> <p>By default the file will be created in a model directory in the root of the repository. This is customizable by adding a model configuration to the chainfile as follows:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  models<span class="token operator">:</span> <span class="token punctuation">{</span>
    directory<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'server'</span><span class="token punctuation">,</span> <span class="token string">'models'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  knex<span class="token operator">:</span>  path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'knex.js'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="the-controller"><a href="#the-controller" class="header-anchor">#</a> The Controller</h3> <p>The next file created is the controller. This will control both the API and the view routes. For the view routes it's quite simple, it will fetch, through the model, the needed data and render the ejs file. Things get more interesting with the API routes.</p> <p>A good function to analyze how the Chinchay controller adds value is the find function, so let's look at it first:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token keyword">const</span> <span class="token function-variable function">find</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> options <span class="token operator">=</span> Table<span class="token punctuation">.</span><span class="token function">extractOptions</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> columns <span class="token operator">=</span> Table<span class="token punctuation">.</span><span class="token function">extractColumns</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> query <span class="token operator">=</span> Table<span class="token punctuation">.</span><span class="token function">extractQuery</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Coffee<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> columns<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">results</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> json <span class="token operator">=</span> httpResponse<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">'Busqueda encontrada exitosamente'</span><span class="token punctuation">,</span> <span class="token string">'data'</span><span class="token punctuation">,</span> results<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> json<span class="token punctuation">.</span>data<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        json<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>links <span class="token operator">=</span> <span class="token constant">HATEOAS</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> code <span class="token operator">=</span> errorHandler<span class="token punctuation">.</span><span class="token function">getHTTPCode</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> message <span class="token operator">=</span> errorHandler<span class="token punctuation">.</span><span class="token function">getHTTPMessage</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> json <span class="token operator">=</span> httpResponse<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> error<span class="token punctuation">,</span> code<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="client-queries"><a href="#client-queries" class="header-anchor">#</a> Client Queries</h4> <p>So it starts by extracting the options, columns and query from the query, what is that? Chinchay offers a flexible API where the client can query and decide what it really wants. You can do stuff like this:</p> <ul><li><code>localhost:3000/api/coffee?</code>  Will return all the coffees</li> <li><code>localhost:3000/api/coffee?price=100</code> Will return all the coffees where the price = 100</li> <li><code>localhost:3000/api/coffee?price=100&amp;columns=name</code> Will return only the names of all the coffees where the price = 100</li> <li><code>localhost:3000/api/coffee?price=100&amp;columns=[&quot;id&quot;,&quot;name&quot;]&amp;orderBy=id</code> Will return the names and ids of all the coffees where the price = 100, ordered by id.</li></ul> <p>There are tons of more things that can be done! Check the  <a href="./clientside">client side documentation</a>. Also if you are interested in knowing what is the difference between query, columns and options check the <a href="./model">model documentation</a>.</p> <h4 id="hateoas"><a href="#hateoas" class="header-anchor">#</a> HATEOAS</h4> <p>Then the model goes and finds all the data, filtering and sorting according to what was determined in the options, columns and query. If it's successful we can see how HATEOAS is added to the property links of every element. If we look at the beginning of the API functions we will see that a HateoasGenerator is initialized. Here all the links that the HATEOAS should have are added. It comes with some default values, if you need to add more, edit or delete just go ahead. The default configuration will add a link as follows:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Busqueda encontrada exitosamente&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      <span class="token string">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token string">&quot;created_at&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2018-11-21T11:57:02.767Z&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;links&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token string">&quot;rel&quot;</span><span class="token operator">:</span> <span class="token string">&quot;self&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;href&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/api/coffee/2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;GET&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> <span class="token string">&quot;rel&quot;</span><span class="token operator">:</span> <span class="token string">&quot;edit&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;href&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/api/coffee/2/edit&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> <span class="token string">&quot;rel&quot;</span><span class="token operator">:</span> <span class="token string">&quot;delete&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;href&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/api/coffee/2/delete&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;DELETE&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> <span class="token string">&quot;rel&quot;</span><span class="token operator">:</span> <span class="token string">&quot;new&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;href&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/api/coffee/new&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> <span class="token string">&quot;rel&quot;</span><span class="token operator">:</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;href&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/api/coffee/find&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;GET&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> <span class="token string">&quot;rel&quot;</span><span class="token operator">:</span> <span class="token string">&quot;count&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;href&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/api/coffee/count&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;GET&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>For more information on this, see the <a href="./hateoas">HateoasGenerator documentation</a>.</p> <h4 id="error-handler"><a href="#error-handler" class="header-anchor">#</a> Error handler</h4> <p>But what happens when the the model throws an error and goes to the catch block? For instance, maybe we are trying to filter by a non existing column? Enters the <a href="./errorhandler">ErrorHandler</a>. For many years this troubled me greatly. Should I return a 500 error or a 400? what should be the message to show in the frontend? To tackle this, the ErrorHandlers maps backend errors to a human-readable message and a http code. The ErrorHandler comes with some translations predefined but you can override them, add more, etc. For more information, check the <a href="./errorhandler">ErrorHandler Documentation</a>.</p> <h4 id="where-it-s-created-and-why-there-3"><a href="#where-it-s-created-and-why-there-3" class="header-anchor">#</a> Where it's created and why there?</h4> <p>By default the file will be created in a controller directory in the root of the repository. This is customizable by adding a controller configuration to the chainfile as follows:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  controllers<span class="token operator">:</span> <span class="token punctuation">{</span>
    directory<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'server'</span><span class="token punctuation">,</span> <span class="token string">'controllers'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  knex<span class="token operator">:</span>  path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'knex.js'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="the-router"><a href="#the-router" class="header-anchor">#</a> The Router</h3> <p>Two routing files will be created. The first one for rendering ejs files and the other for the API endpoints. If the app is configured for angular, a file will be generated to work with the angular router. They will be generated in the routes folder, however you can customize this by adding the following to the chainfile:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  routes<span class="token operator">:</span> <span class="token punctuation">{</span>
    directory<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'server'</span><span class="token punctuation">,</span> <span class="token string">'routes'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  knex<span class="token operator">:</span>  path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'knex.js'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">IMPORTANT!!!</p> <p>This must be added manually to the express router. Check the <a href="/gettingstarted/ejs.html#using-chinchay">Getting Started tutorial</a> and/or the <a href="../gettingstarted/angular">Chinchay + Angular tutorial</a> to see how they can be added.</p></div> <h3 id="the-views"><a href="#the-views" class="header-anchor">#</a> The views</h3> <p>Last but not least, a bunch of view files are created. This varies deeply if Chinchay is configured for ejs or angular. However, in any case the following will be generated:</p> <ul><li>An index which lists all the entries. This will have buttons to edit, delete and view each entry. Also a button to create a new entry.</li> <li>A view of the entry where you can see the properties of a given entry. Buttons to edit, delete and go to the index will be provided.</li> <li>An editing page, where the properties of a given entry can be edited.</li> <li>An create page, where a new entry can be created.</li> <li>A way to connect to the backend API (for instance an Angular service)</li></ul> <p>This might vary depending on the frontend configuration. We strongly recommend you check the <a href="/gettingstarted/ejs.html#using-chinchay">Getting Started tutorial</a> and/or the <a href="../gettingstarted/angular">Chinchay + Angular tutorial</a> to get a grasp on how to work with these files.</p> <h2 id="frontend-and-backend"><a href="#frontend-and-backend" class="header-anchor">#</a> frontend and backend</h2> <p>Are you developing an API without frontend? Or is the API already created and you are just building an angular app? Well here we will explain to you two flags that can be used when running the new command.</p> <h3 id="frontend-flag"><a href="#frontend-flag" class="header-anchor">#</a> frontend flag</h3> <p>This can be either <code>ejs</code>, <code>angular</code> or <code>disable</code>. So if you ran:</p> <div class="language- extra-class"><pre class="language-text"><code>$ chinchay new coffee --frontend angular
</code></pre></div><p>The views generated will correspond to angular components, services and routes for the Angular router. If the flag is defined with <code>ejs</code> equivalent files will be created.</p> <p>If you are building an API with no frontend, you may disable it creating zero view files:</p> <div class="language- extra-class"><pre class="language-text"><code>$ chinchay new coffee --frontend disable
</code></pre></div><p>By default it's set to <code>ejs</code>.</p> <h3 id="backend-flag"><a href="#backend-flag" class="header-anchor">#</a> backend flag</h3> <p>This can be either <code>enable</code> or <code>disable</code>. So if you ran:</p> <div class="language- extra-class"><pre class="language-text"><code>$ chinchay new coffee --backend disable
</code></pre></div><p>The model, controller and corresponding routes will be omitted.</p> <p>By default it's enabled.</p> <h3 id="adding-it-to-the-chainfile"><a href="#adding-it-to-the-chainfile" class="header-anchor">#</a> Adding it to the chainfile</h3> <p>Having to pass the flag everytime can be exhausting... that's why you might add it to the chainfile to make life easier:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  frontend<span class="token operator">:</span> <span class="token string">'angular'</span><span class="token punctuation">,</span>
  backend<span class="token operator">:</span> <span class="token string">'disable'</span><span class="token punctuation">,</span>
  knex<span class="token operator">:</span>  path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'knex.js'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>If it is both defined in the chainfile and passed as a flag, Chinchay will use the flag configuration over the chainfile configuration.</p></div> <h2 id="the-middleware-flag"><a href="#the-middleware-flag" class="header-anchor">#</a> the middleware flag</h2> <p>If you are developing a top secret app, and you need to protect your routes so they are publicly accessible you can add the middleware flag to protect your routes. The possible values are <code>api</code>, <code>frontend</code>, <code>enable</code> and <code>disable</code>. So if I ran the following command:</p> <div class="language- extra-class"><pre class="language-text"><code>$ chinchay new coffee --middleware api
</code></pre></div><p>Users accessing the api routes will have to show a valid token to pass. Whereas the ejs files are publicly accessible. If the command is ran with <code>--middleware frontend</code> it's the other way around. As I guess you already figure it out, if the flag is defined and disable, all routes are public (this is the default configuration) and if it's enable all the routes are protected.  Check the <a href="./middleware">Middleware documentation</a> to see how to work around with it.</p> <div class="custom-block danger"><p class="custom-block-title">WARNING</p> <p>VERY IMPORTANT: if you are protecting your routes you <strong>must</strong> provide a secret for the middleware by defining the JWT_SECRET environment variable.</p></div> <p>This configuration can also be added to the chainfile:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  middleware<span class="token operator">:</span> <span class="token string">'api'</span><span class="token punctuation">,</span>
  knex<span class="token operator">:</span>  path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'knex.js'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>If it is both defined in the chainfile and passed as a flag, Chinchay will use the flag configuration over the chainfile configuration.</p></div> <h2 id="do-i-prefer-camels-or-snakes"><a href="#do-i-prefer-camels-or-snakes" class="header-anchor">#</a> Do I prefer üê´camels or üêçsnakes?</h2> <p>Always a moot point... I usually go for camelCase except for databases and json properties. And well kebabs for files. However, Chinchay doesn't care. It will be able to process all of this:</p> <div class="language- extra-class"><pre class="language-text"><code>$ chinchay new tea_cup
$ chinchay new teaCup
$ chinchay new TeaCup
$ chinchay new tea-cup
$ chinchay new TEA-CUP
$ chinchay new TEA_CUP
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ‚Üê
      <a href="/docs/overview.html" class="prev">
        Overview: What is Chinchay?
      </a></span> <span class="next"><a href="/docs/chainfile.html">
        Chainfile
      </a>
      ‚Üí
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.2773cf3e.js" defer></script><script src="/assets/js/2.3f720234.js" defer></script><script src="/assets/js/9.0aa8bee1.js" defer></script>
  </body>
</html>
