<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Overview | Chinchay Docs</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="">
    <link rel="preload" href="/assets/css/0.styles.ab30e0ca.css" as="style"><link rel="preload" href="/assets/js/app.2773cf3e.js" as="script"><link rel="preload" href="/assets/js/2.3f720234.js" as="script"><link rel="preload" href="/assets/js/30.42d9cb16.js" as="script"><link rel="prefetch" href="/assets/js/10.1edc54dd.js"><link rel="prefetch" href="/assets/js/11.2f00b1d8.js"><link rel="prefetch" href="/assets/js/12.1f05b6b4.js"><link rel="prefetch" href="/assets/js/13.c98ba095.js"><link rel="prefetch" href="/assets/js/14.1b2b2c75.js"><link rel="prefetch" href="/assets/js/15.702d946e.js"><link rel="prefetch" href="/assets/js/16.a41c1694.js"><link rel="prefetch" href="/assets/js/17.335d4649.js"><link rel="prefetch" href="/assets/js/18.23ce0973.js"><link rel="prefetch" href="/assets/js/19.aa8171a6.js"><link rel="prefetch" href="/assets/js/20.fcee7802.js"><link rel="prefetch" href="/assets/js/21.84451ad4.js"><link rel="prefetch" href="/assets/js/22.ca5d3982.js"><link rel="prefetch" href="/assets/js/23.d5279137.js"><link rel="prefetch" href="/assets/js/24.41953457.js"><link rel="prefetch" href="/assets/js/25.6f8b54bd.js"><link rel="prefetch" href="/assets/js/26.9965863d.js"><link rel="prefetch" href="/assets/js/27.5c297913.js"><link rel="prefetch" href="/assets/js/28.cc8160a1.js"><link rel="prefetch" href="/assets/js/29.3a7bb5f9.js"><link rel="prefetch" href="/assets/js/3.6a2b7fa3.js"><link rel="prefetch" href="/assets/js/31.071fae85.js"><link rel="prefetch" href="/assets/js/32.9325ffa2.js"><link rel="prefetch" href="/assets/js/33.4af5988e.js"><link rel="prefetch" href="/assets/js/34.c865156d.js"><link rel="prefetch" href="/assets/js/35.d3ce8ef4.js"><link rel="prefetch" href="/assets/js/36.11f74532.js"><link rel="prefetch" href="/assets/js/4.1b09c2c5.js"><link rel="prefetch" href="/assets/js/5.5c4c1fbb.js"><link rel="prefetch" href="/assets/js/6.b0461825.js"><link rel="prefetch" href="/assets/js/7.3211b211.js"><link rel="prefetch" href="/assets/js/8.a7dcf5bf.js"><link rel="prefetch" href="/assets/js/9.0aa8bee1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ab30e0ca.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Chinchay Docs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/gettingstarted/" class="nav-link">
  Getting Started
</a></div><div class="nav-item"><a href="/docs/" class="nav-link">
  Docs
</a></div><div class="nav-item"><a href="/models/" class="nav-link router-link-active">
  The Model
</a></div><div class="nav-item"><a href="/middleware/" class="nav-link">
  Middleware
</a></div><div class="nav-item"><a href="/errorhandler/" class="nav-link">
  Error Handler
</a></div><div class="nav-item"><a href="/collaborate/" class="nav-link">
  Collaborate!
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/gettingstarted/" class="nav-link">
  Getting Started
</a></div><div class="nav-item"><a href="/docs/" class="nav-link">
  Docs
</a></div><div class="nav-item"><a href="/models/" class="nav-link router-link-active">
  The Model
</a></div><div class="nav-item"><a href="/middleware/" class="nav-link">
  Middleware
</a></div><div class="nav-item"><a href="/errorhandler/" class="nav-link">
  Error Handler
</a></div><div class="nav-item"><a href="/collaborate/" class="nav-link">
  Collaborate!
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/models/newsave.html" class="sidebar-link">New</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/models/newsave.html#new" class="sidebar-link">New</a></li><li class="sidebar-sub-header"><a href="/models/newsave.html#save" class="sidebar-link">Save</a></li><li class="sidebar-sub-header"><a href="/models/newsave.html#save-several-at-once" class="sidebar-link">Save several at once</a></li></ul></li><li><a href="/models/find.html" class="sidebar-link">Find</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/models/find.html#overview" class="sidebar-link">Overview</a></li><li class="sidebar-sub-header"><a href="/models/find.html#simple-queries" class="sidebar-link">Simple Queries</a></li><li class="sidebar-sub-header"><a href="/models/find.html#queries-for-masters" class="sidebar-link">Queries for Masters</a></li><li class="sidebar-sub-header"><a href="/models/find.html#queries-for-and-or" class="sidebar-link">Queries for and/or</a></li><li class="sidebar-sub-header"><a href="/models/find.html#columns" class="sidebar-link">columns</a></li><li class="sidebar-sub-header"><a href="/models/find.html#startdate-and-enddate" class="sidebar-link">startDate and endDate</a></li><li class="sidebar-sub-header"><a href="/models/find.html#distinct" class="sidebar-link">distinct</a></li><li class="sidebar-sub-header"><a href="/models/find.html#order-by-limit-and-offset" class="sidebar-link">Order by, limit and offset</a></li><li class="sidebar-sub-header"><a href="/models/find.html#rawselect-and-rawwhere" class="sidebar-link">rawSelect and RawWhere</a></li><li class="sidebar-sub-header"><a href="/models/find.html#group-by" class="sidebar-link">Group By</a></li><li class="sidebar-sub-header"><a href="/models/find.html#return-as-query" class="sidebar-link">Return as Query</a></li><li class="sidebar-sub-header"><a href="/models/find.html#findbyid" class="sidebar-link">FindById</a></li><li class="sidebar-sub-header"><a href="/models/find.html#all" class="sidebar-link">all</a></li><li class="sidebar-sub-header"><a href="/models/find.html#findidin" class="sidebar-link">findIdIn</a></li><li class="sidebar-sub-header"><a href="/models/find.html#findin" class="sidebar-link">findIn</a></li><li class="sidebar-sub-header"><a href="/models/find.html#arrayofids" class="sidebar-link">arrayOfIds</a></li></ul></li><li><a href="/models/count.html" aria-current="page" class="active sidebar-link">Count</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/models/count.html#overview" class="sidebar-link">Overview</a></li><li class="sidebar-sub-header"><a href="/models/count.html#count-search-examples" class="sidebar-link">Count: Search Examples</a></li><li class="sidebar-sub-header"><a href="/models/count.html#startdate-and-enddate" class="sidebar-link">startDate and endDate</a></li><li class="sidebar-sub-header"><a href="/models/count.html#rawwhere" class="sidebar-link">rawWhere</a></li><li class="sidebar-sub-header"><a href="/models/count.html#group-by" class="sidebar-link">Group By</a></li><li class="sidebar-sub-header"><a href="/models/count.html#countdistinct" class="sidebar-link">countDistinct</a></li><li class="sidebar-sub-header"><a href="/models/count.html#return-as-query" class="sidebar-link">Return as Query</a></li><li class="sidebar-sub-header"><a href="/models/count.html#countgroupby" class="sidebar-link">countGroupBy</a></li><li class="sidebar-sub-header"><a href="/models/count.html#countin" class="sidebar-link">countIn</a></li></ul></li><li><a href="/models/update.html" class="sidebar-link">Update</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/models/update.html#overview" class="sidebar-link">Overview</a></li><li class="sidebar-sub-header"><a href="/models/update.html#update" class="sidebar-link">update</a></li><li class="sidebar-sub-header"><a href="/models/update.html#updatebyid" class="sidebar-link">updateById</a></li><li class="sidebar-sub-header"><a href="/models/update.html#what-cannot-be-set" class="sidebar-link">what cannot be set</a></li></ul></li><li><a href="/models/delete.html" class="sidebar-link">Delete</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/models/delete.html#overview" class="sidebar-link">Overview</a></li><li class="sidebar-sub-header"><a href="/models/delete.html#delete" class="sidebar-link">delete</a></li><li class="sidebar-sub-header"><a href="/models/delete.html#deletebyid" class="sidebar-link">deleteById</a></li></ul></li><li><a href="/models/aggregation.html" class="sidebar-link">Sum, Min &amp; Max</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/models/aggregation.html#overview" class="sidebar-link">Overview</a></li><li class="sidebar-sub-header"><a href="/models/aggregation.html#sum" class="sidebar-link">Sum</a></li><li class="sidebar-sub-header"><a href="/models/aggregation.html#max" class="sidebar-link">Max</a></li><li class="sidebar-sub-header"><a href="/models/aggregation.html#min" class="sidebar-link">Min</a></li><li class="sidebar-sub-header"><a href="/models/aggregation.html#sum-search-examples" class="sidebar-link">sum: Search Examples</a></li><li class="sidebar-sub-header"><a href="/models/aggregation.html#startdate-and-enddate" class="sidebar-link">startDate and endDate</a></li><li class="sidebar-sub-header"><a href="/models/aggregation.html#rawwhere" class="sidebar-link">rawWhere</a></li><li class="sidebar-sub-header"><a href="/models/aggregation.html#group-by" class="sidebar-link">Group By</a></li><li class="sidebar-sub-header"><a href="/models/aggregation.html#return-as-query" class="sidebar-link">Return as Query</a></li></ul></li><li><a href="/models/miscellaneous.html" class="sidebar-link">Miscellaneous</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/models/miscellaneous.html#overview" class="sidebar-link">Overview</a></li><li class="sidebar-sub-header"><a href="/models/miscellaneous.html#columnsnames" class="sidebar-link">columnsNames</a></li><li class="sidebar-sub-header"><a href="/models/miscellaneous.html#getfirstdate" class="sidebar-link">getFirstDate</a></li><li class="sidebar-sub-header"><a href="/models/miscellaneous.html#extractoptions-extractcolumns-extractsearch" class="sidebar-link">extractOptions, extractColumns, extractSearch</a></li></ul></li><li><a href="/models/customMethods.html" class="sidebar-link">Creating your own methods</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/models/customMethods.html#overview" class="sidebar-link">Overview</a></li><li class="sidebar-sub-header"><a href="/models/customMethods.html#creating-custom-methods" class="sidebar-link">Creating custom methods</a></li><li class="sidebar-sub-header"><a href="/models/customMethods.html#overwriting-existing-methods" class="sidebar-link">Overwriting existing methods</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="overview"><a href="#overview" class="header-anchor">#</a> Overview</h2> <p>Here we are going to talk about the <code>count</code> method. This is an asynchronous method that returns the amount of entries that matches with the given search. So let's dive into it!</p> <h3 id="parameters"><a href="#parameters" class="header-anchor">#</a> Parameters</h3> <ul><li>Search: Javascript object with the definition of what should be searched.</li> <li>Options: A javascript object for more configurations, such as sorting, grouping, etc.</li></ul> <p>In this tutorial we are going to see several examples. However for a fully detailed tutorial of these parameters check the <a href="./find">find documentation</a>.</p> <h3 id="return-value"><a href="#return-value" class="header-anchor">#</a> Return value</h3> <p>An integer indicating the amount of entries which meets with the requested:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token number">2</span>
</code></pre></div><h2 id="count-search-examples"><a href="#count-search-examples" class="header-anchor">#</a> Count: Search Examples</h2> <p>Let's go for the fun part:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  Coffee<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">{</span> price<span class="token operator">:</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This will count all the coffees of price = 100.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  Coffee<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">{</span> price<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'latte'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This will count all the coffees of price = 100 and name = 'latte'.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  Coffee<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code>  Coffee<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If no search is defined, it will count all the entries. The same behaviour will occur if an empty search is provided.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  Coffee<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">{</span> price<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'&gt;'</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This will count all the coffees where the price is greater than 100.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  Coffee<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">{</span> price<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'&lt;&gt;'</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'latte'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This will count all the coffees where the price is distinct to 100 and the name is 'latte'.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  Coffee<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">{</span> price<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'in'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This is one of my favorites, in this case it will count all the entries where the price is either 90 or 100.</p> <h2 id="startdate-and-enddate"><a href="#startdate-and-enddate" class="header-anchor">#</a> startDate and endDate</h2> <p>Let's assume you want to count all the coffees that were created before 2020? We could do it as follows:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  Coffee<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">{</span> created_at<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'&lt;'</span><span class="token punctuation">,</span> <span class="token string">'2020-01-01 00:00:00.000'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>And that's totally fine, however this can also be achieved using the third parameter: <code>options</code>. The <code>startDate</code> and <code>endDate</code> can be defined to count values created at a certain interval.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  Coffee<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> startDate<span class="token operator">:</span><span class="token string">'2018-11-21T11:55:00.000Z'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>In this case it will count all the entries where the created_at is after the given startDate, in this case, after 2018-11-21T11:55:00.000Z.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code> Coffee<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> endDate<span class="token operator">:</span><span class="token string">'2018-11-21T12:00:00.000Z'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>In this case it will count all the entries where the created_at is after the given startDate, in this case, before 2018-11-21T12:00:00.000Z..</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code> Coffee<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> endDate<span class="token operator">:</span><span class="token string">'2018-11-21T12:00:00.000Z'</span><span class="token punctuation">,</span> startDate<span class="token operator">:</span> <span class="token string">'2018-11-21T11:55:00.000Z&amp;'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>In this case it will count all the entries where the created_at is in between the given startDate and endDate, in this case, between 2018-11-21T11:55:00.000Z and 2018-11-21T12:00:00.000Z.</p> <h2 id="rawwhere"><a href="#rawwhere" class="header-anchor">#</a> rawWhere</h2> <p>Now this is getting advanced, this is intended for people who know SQL. Sometimes we have crazy ideas and we need even more sophisticated queries. In the options we can pass a <code>rawWhere</code> property.</p> <p>RawWhere allows you to be even more specific on how you want to filter your results, sometimes we just do weird queries. It can be given as a string or an array for sql injection. Let's look at some examples:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Coffee<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> rawWhere<span class="token operator">:</span> <span class="token string">&quot;name = 'expensive' or price = 100 &quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If you want to count all the coffees where they are either named expensive or priced at 100, the previous rawWhere will allow you to do so.</p> <h4 id="sql-injection"><a href="#sql-injection" class="header-anchor">#</a> SQL Injection</h4> <div class="custom-block danger"><p class="custom-block-title">WARNING</p> <p>Be very careful with this as it can be used as <a href="https://www.acunetix.com/websitesecurity/sql-injection/" target="_blank" rel="noopener noreferrer">sql injection<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. As Uncle Ben once said, <em>with great power comes great responsability</em>.</p></div> <p><a href="https://www.acunetix.com/websitesecurity/sql-injection/" target="_blank" rel="noopener noreferrer">Sql injection<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> is one of the most typical and dangerous attacks a website can receive, so it is important to be extremely careful about it. If you do not know what it is, this meme should explain it:</p> <p><img src="https://chinchay-docs.herokuapp.com/assets/sql-injections.png" alt="SQL INJECTION"></p> <p>To prevent sql injections you can define the rawSelect as an array. An example:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code> Coffee<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> rawWhere<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;name = ? or price = ? &quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;expensive&quot;</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>In this case <code>expensive</code> and <code>100</code> are indicated as <code>?</code> and passed in a second parameter.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>If by any chance a user input will be used to create the <code>rawWhere</code>, the <code>rawWhere</code> <strong>MUST</strong> be in array form and the user input passed as the second value of that array.</p></div> <h2 id="group-by"><a href="#group-by" class="header-anchor">#</a> Group By</h2> <p>For some use cases grouping your response can be very helpful. For instance, let's assume we want to count all the entries by price, in other words how many coffees cost 1, how many cost 2, and so on. This can be achieved by the group by:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  Coffee<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>groupBy<span class="token operator">:</span> <span class="token string">'price'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This will no longer return a single integer it will return an array as follows:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">[</span> <span class="token punctuation">{</span> count<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> price<span class="token operator">:</span> <span class="token number">12</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> count<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> price<span class="token operator">:</span> <span class="token number">100</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span>
</code></pre></div><p>So there is 1 coffee priced at 12, and 2 coffees priced at 100.</p> <h3 id="rawselect"><a href="#rawselect" class="header-anchor">#</a> rawSelect</h3> <p>So now we can pass a RawSelect option that can be very powerful. It can be given as a string or an array for sql injection. For instance:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code> Coffee<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> rawSelect<span class="token operator">:</span> <span class="token string">'EXTRACT(MONTH FROM created_at) as month'</span><span class="token punctuation">,</span> groupBy<span class="token operator">:</span> <span class="token string">'month'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Here we are using the rawSelect to use the psql function extract to return the month of creation. Then we are counting how many entries are created each month.</p> <h4 id="sql-injection-2"><a href="#sql-injection-2" class="header-anchor">#</a> SQL Injection</h4> <div class="custom-block danger"><p class="custom-block-title">WARNING</p> <p>Be very careful with this as it can be used as <a href="https://www.acunetix.com/websitesecurity/sql-injection/" target="_blank" rel="noopener noreferrer">sql injection<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. As Uncle Ben once said, <em>with great power comes great responsability</em>.</p></div> <p><a href="https://www.acunetix.com/websitesecurity/sql-injection/" target="_blank" rel="noopener noreferrer">Sql injection<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> is one of the most typical and dangerous attacks a website can receive, so it is important to be extremely careful about it. If you do not know what it is, this meme should explain it:</p> <p><img src="https://chinchay-docs.herokuapp.com/assets/sql-injections.png" alt="SQL INJECTION"></p> <p>To prevent sql injections you can define the rawSelect as an array. An example:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code> Coffee<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> groupBy<span class="token operator">:</span> <span class="token string">'month'</span><span class="token punctuation">,</span> rawSelect<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'EXTRACT(MONTH FROM ??) as month'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'created_at'</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>In this case the <code>created_at</code> is indicated as <code>??</code> and passed in a second parameter.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>If by any chance a user input will be used to create the <code>rawSelect</code>, the <code>rawSelect</code> <strong>MUST</strong> be in array form and the user input passed as the second value of that array.</p></div> <h2 id="countdistinct"><a href="#countdistinct" class="header-anchor">#</a> countDistinct</h2> <p>For counting distinct values the  <code>countDistinct</code> property comes handy. For instace, if we want to count how many different prices are there, we could use the <code>countDistinct</code> as follows:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token keyword">const</span> query <span class="token operator">=</span> Coffee<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> countDistinct<span class="token operator">:</span> <span class="token string">'price'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="return-as-query"><a href="#return-as-query" class="header-anchor">#</a> Return as Query</h2> <p>Last but definitely not least: <code>returnAsQuery</code>. If this parameter is defined as <code>true</code>, it will return a knex query object. With it you can use all of knex options to build even more sophisticated queries. Let's look at an example:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token keyword">const</span> query <span class="token operator">=</span> Coffee<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> returnAsQuery<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  query<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'tea'</span><span class="token punctuation">,</span> <span class="token string">'coffee.id'</span><span class="token punctuation">,</span> <span class="token string">'='</span><span class="token punctuation">,</span> <span class="token string">'tea.id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This way we can cross the tea table with the coffee relation. This is very powerful and can allow you to do many things!</p> <div class="custom-block tip"><p class="custom-block-title">DEBUGGING TIP</p> <p>For debugging, set <code>{ returnAsQuery: true }</code> and then do <code>console.log(query.toString())</code> and you will be able to see the psql command.</p></div> <h2 id="countgroupby"><a href="#countgroupby" class="header-anchor">#</a> countGroupBy</h2> <p>The same done by passing the groupBy in the options can be achieved with the countGroupBy method.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Coffee<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> groupBy<span class="token operator">:</span> <span class="token string">'price'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Is equivalent to:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  Coffee<span class="token punctuation">.</span><span class="token function">countGroupBy</span><span class="token punctuation">(</span><span class="token string">'price'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>In my opinion it is &quot;cleaner&quot; to just use the count method.</p></div> <h2 id="countin"><a href="#countin" class="header-anchor">#</a> countIn</h2> <p>The <code>countIn</code> method will count all the entries where the <code>target</code> parameter is within the <code>validOptions</code>. This can also be done using the <code>count</code> method:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  Coffee<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">{</span> price<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'in'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Is equivalent to:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  Coffee<span class="token punctuation">.</span><span class="token function">countIn</span><span class="token punctuation">(</span><span class="token string">'price'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>In my personal opinion it is &quot;cleaner&quot; to just use the count method.</p></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/models/find.html" class="prev">
        Find
      </a></span> <span class="next"><a href="/models/update.html">
        Update
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.2773cf3e.js" defer></script><script src="/assets/js/2.3f720234.js" defer></script><script src="/assets/js/30.42d9cb16.js" defer></script>
  </body>
</html>
