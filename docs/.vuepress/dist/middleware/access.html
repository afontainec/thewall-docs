<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Overview | Chinchay Docs</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="">
    <link rel="preload" href="/assets/css/0.styles.ab30e0ca.css" as="style"><link rel="preload" href="/assets/js/app.2773cf3e.js" as="script"><link rel="preload" href="/assets/js/2.3f720234.js" as="script"><link rel="preload" href="/assets/js/25.6f8b54bd.js" as="script"><link rel="prefetch" href="/assets/js/10.1edc54dd.js"><link rel="prefetch" href="/assets/js/11.2f00b1d8.js"><link rel="prefetch" href="/assets/js/12.1f05b6b4.js"><link rel="prefetch" href="/assets/js/13.c98ba095.js"><link rel="prefetch" href="/assets/js/14.1b2b2c75.js"><link rel="prefetch" href="/assets/js/15.702d946e.js"><link rel="prefetch" href="/assets/js/16.a41c1694.js"><link rel="prefetch" href="/assets/js/17.335d4649.js"><link rel="prefetch" href="/assets/js/18.23ce0973.js"><link rel="prefetch" href="/assets/js/19.aa8171a6.js"><link rel="prefetch" href="/assets/js/20.fcee7802.js"><link rel="prefetch" href="/assets/js/21.84451ad4.js"><link rel="prefetch" href="/assets/js/22.ca5d3982.js"><link rel="prefetch" href="/assets/js/23.d5279137.js"><link rel="prefetch" href="/assets/js/24.41953457.js"><link rel="prefetch" href="/assets/js/26.9965863d.js"><link rel="prefetch" href="/assets/js/27.5c297913.js"><link rel="prefetch" href="/assets/js/28.cc8160a1.js"><link rel="prefetch" href="/assets/js/29.3a7bb5f9.js"><link rel="prefetch" href="/assets/js/3.6a2b7fa3.js"><link rel="prefetch" href="/assets/js/30.42d9cb16.js"><link rel="prefetch" href="/assets/js/31.071fae85.js"><link rel="prefetch" href="/assets/js/32.9325ffa2.js"><link rel="prefetch" href="/assets/js/33.4af5988e.js"><link rel="prefetch" href="/assets/js/34.c865156d.js"><link rel="prefetch" href="/assets/js/35.d3ce8ef4.js"><link rel="prefetch" href="/assets/js/36.11f74532.js"><link rel="prefetch" href="/assets/js/4.1b09c2c5.js"><link rel="prefetch" href="/assets/js/5.5c4c1fbb.js"><link rel="prefetch" href="/assets/js/6.b0461825.js"><link rel="prefetch" href="/assets/js/7.3211b211.js"><link rel="prefetch" href="/assets/js/8.a7dcf5bf.js"><link rel="prefetch" href="/assets/js/9.0aa8bee1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ab30e0ca.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Chinchay Docs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/gettingstarted/" class="nav-link">
  Getting Started
</a></div><div class="nav-item"><a href="/docs/" class="nav-link">
  Docs
</a></div><div class="nav-item"><a href="/models/" class="nav-link">
  The Model
</a></div><div class="nav-item"><a href="/middleware/" class="nav-link router-link-active">
  Middleware
</a></div><div class="nav-item"><a href="/errorhandler/" class="nav-link">
  Error Handler
</a></div><div class="nav-item"><a href="/collaborate/" class="nav-link">
  Collaborate!
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/gettingstarted/" class="nav-link">
  Getting Started
</a></div><div class="nav-item"><a href="/docs/" class="nav-link">
  Docs
</a></div><div class="nav-item"><a href="/models/" class="nav-link">
  The Model
</a></div><div class="nav-item"><a href="/middleware/" class="nav-link router-link-active">
  Middleware
</a></div><div class="nav-item"><a href="/errorhandler/" class="nav-link">
  Error Handler
</a></div><div class="nav-item"><a href="/collaborate/" class="nav-link">
  Collaborate!
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/middleware/access.html" aria-current="page" class="active sidebar-link">Access</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/middleware/access.html#overview" class="sidebar-link">Overview</a></li><li class="sidebar-sub-header"><a href="/middleware/access.html#configure" class="sidebar-link">Configure</a></li><li class="sidebar-sub-header"><a href="/middleware/access.html#isadmin" class="sidebar-link">isAdmin</a></li><li class="sidebar-sub-header"><a href="/middleware/access.html#hasaccesstoall" class="sidebar-link">hasAccessToAll</a></li><li class="sidebar-sub-header"><a href="/middleware/access.html#accessiblesids" class="sidebar-link">accessiblesIds</a></li><li class="sidebar-sub-header"><a href="/middleware/access.html#addaccessibletosearch" class="sidebar-link">addAccessibleToSearch</a></li><li class="sidebar-sub-header"><a href="/middleware/access.html#find" class="sidebar-link">find</a></li><li class="sidebar-sub-header"><a href="/middleware/access.html#hasaccessto" class="sidebar-link">hasAccessTo</a></li><li class="sidebar-sub-header"><a href="/middleware/access.html#generatetoken" class="sidebar-link">generateToken</a></li><li class="sidebar-sub-header"><a href="/middleware/access.html#token-encryption" class="sidebar-link">Token Encryption</a></li></ul></li><li><a href="/middleware/middleware.html" class="sidebar-link">Middleware</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/middleware/middleware.html#overview" class="sidebar-link">Overview</a></li><li class="sidebar-sub-header"><a href="/middleware/middleware.html#hasaccess" class="sidebar-link">hasAccess</a></li><li class="sidebar-sub-header"><a href="/middleware/middleware.html#configuring-prerouting-and-postrouting" class="sidebar-link">Configuring: prerouting and postrouting</a></li><li class="sidebar-sub-header"><a href="/middleware/middleware.html#automating-with-cli-the-middleware-flag" class="sidebar-link">Automating with CLI: the middleware flag</a></li><li class="sidebar-sub-header"><a href="/middleware/middleware.html#token-encryption" class="sidebar-link">Token Encryption</a></li><li class="sidebar-sub-header"><a href="/middleware/middleware.html#token-expiration-date" class="sidebar-link">Token Expiration Date</a></li></ul></li><li><a href="/middleware/http-response.html" class="sidebar-link">httpResponse</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/middleware/http-response.html#overview" class="sidebar-link">Overview</a></li><li class="sidebar-sub-header"><a href="/middleware/http-response.html#success" class="sidebar-link">Success</a></li><li class="sidebar-sub-header"><a href="/middleware/http-response.html#error" class="sidebar-link">Error</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="overview"><a href="#overview" class="header-anchor">#</a> Overview</h2> <p>The Access Module has two Functions. The first one is to be in charge of generating an access token. This token follows the json web token standard, by generating the token with the <a href="https://www.npmjs.com/package/jsonwebtoken" target="_blank" rel="noopener noreferrer">jsonwebtoken<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> npm package. The routes protected by the Middleware will expect requests to hold this token as a Bearer token.</p> <p>Second, it restricts which users can access different content, functionalities, functions, etc. It works with roles, where each user can have many roles. Each role will give him access to certain data and/or functionalities. There are two types of roles:</p> <ul><li>RESTRICTED ROLES: roles that have access to a particular entry. Its accessibility is limited to that entry. For example, let's assume you have an app with information about coffees, if a user can only access 1 particular coffee, he should be granted a restricted role.</li> <li>UNRESTRICTED_ROLES: roles that have complete access on a particular module or subdivision of the app. Usually used for a certain database relation. Let's assume you have an app with information about coffees and teas, if a user can access all the coffees but not the teas, he should be granted an unrestricted role in coffees.</li></ul> <p>This module works side by side with <a href="https://www.npmjs.com/package/thewall" target="_blank" rel="noopener noreferrer">TheWall<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. and will require a working instance of TheWall to work properly.</p> <h2 id="configure"><a href="#configure" class="header-anchor">#</a> Configure</h2> <h3 id="restricted-and-unrestricted-roles"><a href="#restricted-and-unrestricted-roles" class="header-anchor">#</a> Restricted and Unrestricted Roles</h3> <p>To configure it, we need to pass it a configuration file indicating which roles are unrestricted and which are restricted. For example let's create an <code>access.js</code> file with the following:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token constant">UNRESTRICTED_ROLES</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  coffee<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'admin'</span><span class="token punctuation">,</span> <span class="token string">'coffeeAdmin'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  tea<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'admin'</span><span class="token punctuation">,</span> <span class="token string">'teaAdmin'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">RESTRICTED_ROLES</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  coffee<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'coffeeDrinker'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  tea<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'teaDrinker'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token constant">UNRESTRICTED_ROLES</span><span class="token punctuation">,</span>
  <span class="token constant">RESTRICTED_ROLES</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>In this example, coffeeAdmin has unrestricted access to the coffees, but no access to the teas, whereas the coffeeDrinker has restricted access to coffee.</p> <p>For Chinchay to use this, the path of the configuration file must be provided in the <code>.chainfile.js</code>:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    access<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'access.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    knex<span class="token operator">:</span>  path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'knex.js'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="thewall"><a href="#thewall" class="header-anchor">#</a> TheWall</h3> <p>Lastly, a <a href="https://www.npmjs.com/package/thewall" target="_blank" rel="noopener noreferrer">TheWall<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> instance must be provided in the <code>chainfile</code>.</p> <p>We create the a <code>thewallfile.js</code> to hold the configuration of the wall:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  access<span class="token operator">:</span> <span class="token punctuation">{</span>
    admin<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'*'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// access everything</span>
    coffeeAdmin<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'/api/coffee/*'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// access to all routes starting with /api/coffee/</span>
    coffeeDrinker<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">'/api/coffee/find'</span><span class="token punctuation">,</span> <span class="token comment">/* index with all the coffee it has access to */</span>
      <span class="token punctuation">[</span><span class="token string">'/api/coffee/:id'</span><span class="token punctuation">,</span> <span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'get'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">/* view the coffee with id=:id, only if it has the role coffeeDrinker to that :id. */</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span> 
    teaAdmin<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'/api/tea/*'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">/* access to all routes starting with /api/tea/ */</span>
    teaDrinker<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">'/api/tea/find'</span><span class="token punctuation">,</span> <span class="token comment">/* index with all the tea it has access to */</span>
      <span class="token punctuation">[</span><span class="token string">'/api/tea/:id'</span><span class="token punctuation">,</span> <span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'get'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">/* view the tea with id=:id, only if it has the role teaDrinker to that :id. */</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  knex<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'knex.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Now create a <code>thewall</code> instance:</p> <div class="language- extra-class"><pre class="language-text"><code>$ touch thewall.js
</code></pre></div><p>Fill the generate fill with:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./thewallfile'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'thewall'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Add it to the <code>chainfile.js</code>:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    access<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'access.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    thewall<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'thewall.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    knex<span class="token operator">:</span>  path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'knex.js'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>For more information as to how to add TheWall instance look at the <a href="../gettingstarted/apiMiddleware">API tutorial</a> and/or the <a href="/chainfile.html#middleware-access-thewall">Chainfile Docs</a>.</p> <h3 id="bootstrap"><a href="#bootstrap" class="header-anchor">#</a> bootstrap</h3> <p>The bootstrap function will be the one that actually loads the configuration files. It will also Bootstrap the <a href="./accessToken">accessToken</a>. This function will be automatically called when requiring Chinchay, developers will hardly ever need to use it. Manually calling this function is a code smell of Chinchay not being properly configured.</p> <h2 id="isadmin"><a href="#isadmin" class="header-anchor">#</a> isAdmin</h2> <h3 id="overview-2"><a href="#overview-2" class="header-anchor">#</a> Overview</h3> <p>There is a special role in Access: the <code>admin</code> role, by default, this role will have unrestricted access to everything.</p> <p>There are two ways you can make a user an <code>admin</code>:</p> <h4 id="the-correct-way-add-a-thewall-role-called-admin"><a href="#the-correct-way-add-a-thewall-role-called-admin" class="header-anchor">#</a> The Correct Way: Add a TheWall role called <code>admin</code></h4> <p>The correct way to indicate that a user is an admin is by adding a TheWall role to that user:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token keyword">const</span> access <span class="token operator">=</span> <span class="token keyword">await</span> TheWall<span class="token punctuation">.</span><span class="token function">addAccess</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>With the following, we have indicated that the user with id=1 is an admin.</p> <h4 id="the-incorrect-way-add-a-is-admin"><a href="#the-incorrect-way-add-a-is-admin" class="header-anchor">#</a> The Incorrect Way: add a is_admin</h4> <p>Well maybe a went a bit too far, it is not &quot;incorrect&quot;, it's more the old fashioned way. Just add a <code>is_admin</code> boolean to the user relation, for example:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>exports<span class="token punctuation">.</span><span class="token function-variable function">up</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">knex</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> knex<span class="token punctuation">.</span>schema<span class="token punctuation">.</span><span class="token function">createTable</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">table</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Incremental id</span>
    table<span class="token punctuation">.</span><span class="token function">increments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    table<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">notNullable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    table<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    table<span class="token punctuation">.</span><span class="token function">boolean</span><span class="token punctuation">(</span><span class="token string">'is_admin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// created_at and updated_at</span>
    table<span class="token punctuation">.</span><span class="token function">timestamps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="parameter"><a href="#parameter" class="header-anchor">#</a> Parameter</h3> <ul><li>user: javascript object representing the requesting user. It should hold the TheWall roles in an <code>access</code> property.</li></ul> <div class="custom-block tip"><p class="custom-block-title">Common Use</p> <p>The most common way of using this method is by passing the <code>req.user</code> property as the <code>user</code> parameter. Note that this property is added by the middleware and if this latter is not configured correctly, particularly the <code>Middleware.prerouting(app)</code> is missing, the <code>req.user</code> property will be absent.</p></div> <h3 id="return-value"><a href="#return-value" class="header-anchor">#</a> Return Value</h3> <ul><li>isAdmin: Boolean indicating if the given user is or not an admin.</li></ul> <h3 id="example"><a href="#example" class="header-anchor">#</a> Example</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code>req<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  access<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>role<span class="token operator">:</span> <span class="token string">'admin'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
Access<span class="token punctuation">.</span><span class="token function">isAdmin</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns true</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code>req<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  access<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>role<span class="token operator">:</span> <span class="token string">'coffeeAdmin'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
Access<span class="token punctuation">.</span><span class="token function">isAdmin</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns false </span>
</code></pre></div><h2 id="hasaccesstoall"><a href="#hasaccesstoall" class="header-anchor">#</a> hasAccessToAll</h2> <h3 id="overview-3"><a href="#overview-3" class="header-anchor">#</a> Overview</h3> <p>Check if the given user has complete access to a particular module or subdivision of the app, in other words if it holds an unrestricted role for the asked module/subdivision. If the user is admin it will assume it has access to it.</p> <h3 id="parameter-2"><a href="#parameter-2" class="header-anchor">#</a> Parameter</h3> <ul><li>user: javascript object representing the requesting user. It should hold the TheWall roles in an <code>access</code> property.</li></ul> <div class="custom-block tip"><p class="custom-block-title">Common Use</p> <p>The most common way of using this method is by passing the <code>req.user</code> property as the <code>user</code> parameter. Note that this property is added by the middleware and if this latter is not configured correctly, particularly the <code>Middleware.prerouting(app)</code> is missing, the <code>req.user</code> property will be absent.</p></div> <ul><li>to: module or subdivision at issue.</li></ul> <h3 id="return-value-2"><a href="#return-value-2" class="header-anchor">#</a> Return Value</h3> <ul><li>hasAccess: Boolean indicating if the given user has unrestricted access to the module or subdivision at issue.</li></ul> <h3 id="examples"><a href="#examples" class="header-anchor">#</a> Examples</h3> <p>This example assumes <a href="#configure">this configuration</a>.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>req<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  access<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>role<span class="token operator">:</span> <span class="token string">'admin'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
Access<span class="token punctuation">.</span><span class="token function">hasAccessToAll</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>user<span class="token punctuation">,</span> <span class="token string">'coffee'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns true</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code>req<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  access<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>role<span class="token operator">:</span> <span class="token string">'coffeeAdmin'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
Access<span class="token punctuation">.</span><span class="token function">hasAccessToAll</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>user<span class="token punctuation">,</span> <span class="token string">'coffee'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns true </span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code>req<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  access<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>role<span class="token operator">:</span> <span class="token string">'teaAdmin'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
Access<span class="token punctuation">.</span><span class="token function">hasAccessToAll</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>user<span class="token punctuation">,</span> <span class="token string">'coffee'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns false </span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code>req<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
  access<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>role<span class="token operator">:</span> <span class="token string">'coffeeDrinker'</span><span class="token punctuation">,</span> filter<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
Access<span class="token punctuation">.</span><span class="token function">hasAccessToAll</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>user<span class="token punctuation">,</span> <span class="token string">'coffee'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns false </span>
</code></pre></div><h2 id="accessiblesids"><a href="#accessiblesids" class="header-anchor">#</a> accessiblesIds</h2> <h3 id="overview-4"><a href="#overview-4" class="header-anchor">#</a> Overview</h3> <p>Returns all the ids/filters to which a given user has access on a particular module or subdivision of the app. In other words it will return an Array with all the <code>filter</code> property of every access it has to a given module/subdivision.</p> <p>This method is intended to be used only for users that do not have unrestricted access.</p> <h3 id="parameter-3"><a href="#parameter-3" class="header-anchor">#</a> Parameter</h3> <ul><li>user: javascript object representing the requesting user. It should hold the TheWall roles in an <code>access</code> property.</li></ul> <div class="custom-block tip"><p class="custom-block-title">Common Use</p> <p>The most common way of using this method is by passing the <code>req.user</code> property as the <code>user</code> parameter. Note that this property is added by the middleware and if this latter is not configured correctly, particularly the <code>Middleware.prerouting(app)</code> is missing, the <code>req.user</code> property will be absent.</p></div> <ul><li>to: module or subdivision at issue.</li></ul> <h3 id="return-value-3"><a href="#return-value-3" class="header-anchor">#</a> Return Value</h3> <ul><li>ids: Array of all the filters of that user's accesses.</li></ul> <h3 id="examples-2"><a href="#examples-2" class="header-anchor">#</a> Examples</h3> <p>This example assumes <a href="#configure">this configuration</a>.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>req<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  access<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>role<span class="token operator">:</span> <span class="token string">'coffeeDrinker'</span><span class="token punctuation">,</span> filter<span class="token operator">:</span> <span class="token string">'1'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>role<span class="token operator">:</span> <span class="token string">'coffeeDrinker'</span><span class="token punctuation">,</span> filter<span class="token operator">:</span> <span class="token string">'2'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
Access<span class="token punctuation">.</span><span class="token function">accessiblesIds</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>user<span class="token punctuation">,</span> <span class="token string">'coffee'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns ['1', '2']</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code>req<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  access<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>role<span class="token operator">:</span> <span class="token string">'coffeeDrinker'</span><span class="token punctuation">,</span> filter<span class="token operator">:</span> <span class="token string">'1'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>role<span class="token operator">:</span> <span class="token string">'teaDrinker'</span><span class="token punctuation">,</span> filter<span class="token operator">:</span> <span class="token string">'2'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
Access<span class="token punctuation">.</span><span class="token function">accessiblesIds</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>user<span class="token punctuation">,</span> <span class="token string">'coffee'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns ['1']</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code>req<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  access<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>role<span class="token operator">:</span> <span class="token string">'teaDrinker'</span><span class="token punctuation">,</span> filter<span class="token operator">:</span> <span class="token string">'1'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>role<span class="token operator">:</span> <span class="token string">'teaDrinker'</span><span class="token punctuation">,</span> filter<span class="token operator">:</span> <span class="token string">'2'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
Access<span class="token punctuation">.</span><span class="token function">accessiblesIds</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>user<span class="token punctuation">,</span> <span class="token string">'coffee'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns []</span>
</code></pre></div><h2 id="addaccessibletosearch"><a href="#addaccessibletosearch" class="header-anchor">#</a> addAccessibleToSearch</h2> <h3 id="overview-5"><a href="#overview-5" class="header-anchor">#</a> Overview</h3> <p>This is one of the most useful methods. It's intended to filter the <code>search</code> parameter of <a href="/models/find.html#parameters">The Model</a> so it does not access data it should not. It will either edit, remove or add properties to the search in order to return only what it is accessible by the user.</p> <p>It is usually used in a controller right before the <a href="../models/find">find</a> or <a href="../models/count">count</a> method of the model is called.</p> <h3 id="parameter-4"><a href="#parameter-4" class="header-anchor">#</a> Parameter</h3> <ul><li>search: The search parameter to filter</li> <li>access: The users access. An array with all it's roles/accesses.</li> <li>tableName: module or subdivision of the app at issue.</li> <li>key: The key/property corresponding to the <code>filter</code> property of the access.</li></ul> <div class="custom-block tip"><p class="custom-block-title">Common Use: access</p> <p>The most common way of using this method is by passing the <code>req.user.access</code> property as the <code>access</code> parameter. Note that this property is added by the middleware and if this latter is not configured correctly, particularly the <code>Middleware.prerouting(app)</code> is missing, the <code>req.user</code> property will be absent.</p></div> <h3 id="return-value-4"><a href="#return-value-4" class="header-anchor">#</a> Return value</h3> <ul><li>search: The filtered search parameter.</li></ul> <h3 id="examples-3"><a href="#examples-3" class="header-anchor">#</a> Examples</h3> <ol><li>If the user is an admin the search will not be changed:</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>req<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token punctuation">{</span>id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> access<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> role<span class="token operator">:</span> <span class="token string">'admin'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> userAccess <span class="token operator">=</span> req<span class="token punctuation">.</span>user<span class="token punctuation">.</span>access <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> search <span class="token operator">=</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
search <span class="token operator">=</span> Access<span class="token punctuation">.</span><span class="token function">addAccessibleToSearch</span><span class="token punctuation">(</span>search<span class="token punctuation">,</span> userAccess<span class="token punctuation">,</span> <span class="token string">'coffee'</span><span class="token punctuation">,</span> <span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Filtered search:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>Access to several entries</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>req<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token punctuation">{</span>id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> access<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> role<span class="token operator">:</span> <span class="token string">'coffeeDrinker'</span><span class="token punctuation">,</span> filter<span class="token operator">:</span> <span class="token string">'2'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> role<span class="token operator">:</span> <span class="token string">'coffeeDrinker'</span><span class="token punctuation">,</span> filter<span class="token operator">:</span> <span class="token string">'3'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> userAccess <span class="token operator">=</span> req<span class="token punctuation">.</span>user<span class="token punctuation">.</span>access <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> search <span class="token operator">=</span> <span class="token punctuation">{</span> price<span class="token operator">:</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
search <span class="token operator">=</span> Access<span class="token punctuation">.</span><span class="token function">addAccessibleToSearch</span><span class="token punctuation">(</span>search<span class="token punctuation">,</span> userAccess<span class="token punctuation">,</span> <span class="token string">'coffee'</span><span class="token punctuation">,</span> <span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Filtered search:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span> price<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span> id<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">'in'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token punctuation">]</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>Searching for a given entry</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>req<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token punctuation">{</span>id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> access<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> role<span class="token operator">:</span> <span class="token string">'coffeeDrinker'</span><span class="token punctuation">,</span> filter<span class="token operator">:</span> <span class="token string">'2'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> role<span class="token operator">:</span> <span class="token string">'coffeeDrinker'</span><span class="token punctuation">,</span> filter<span class="token operator">:</span> <span class="token string">'3'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> userAccess <span class="token operator">=</span> req<span class="token punctuation">.</span>user<span class="token punctuation">.</span>access <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> search <span class="token operator">=</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
search <span class="token operator">=</span> Access<span class="token punctuation">.</span><span class="token function">addAccessibleToSearch</span><span class="token punctuation">(</span>search<span class="token punctuation">,</span> userAccess<span class="token punctuation">,</span> <span class="token string">'coffee'</span><span class="token punctuation">,</span> <span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Filtered search:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span>
</code></pre></div><ol start="4"><li>Searching for a given entry, without access</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>req<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token punctuation">{</span>id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> access<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> role<span class="token operator">:</span> <span class="token string">'coffeeDrinker'</span><span class="token punctuation">,</span> filter<span class="token operator">:</span> <span class="token string">'2'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> role<span class="token operator">:</span> <span class="token string">'coffeeDrinker'</span><span class="token punctuation">,</span> filter<span class="token operator">:</span> <span class="token string">'3'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> userAccess <span class="token operator">=</span> req<span class="token punctuation">.</span>user<span class="token punctuation">.</span>access <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> search <span class="token operator">=</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
search <span class="token operator">=</span> Access<span class="token punctuation">.</span><span class="token function">addAccessibleToSearch</span><span class="token punctuation">(</span>search<span class="token punctuation">,</span> userAccess<span class="token punctuation">,</span> <span class="token string">'coffee'</span><span class="token punctuation">,</span> <span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Filtered search:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">'in'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span>
</code></pre></div><ol start="5"><li>Searching for an array of options</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>req<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token punctuation">{</span>id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> access<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> role<span class="token operator">:</span> <span class="token string">'coffeeDrinker'</span><span class="token punctuation">,</span> filter<span class="token operator">:</span> <span class="token string">'2'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> role<span class="token operator">:</span> <span class="token string">'coffeeDrinker'</span><span class="token punctuation">,</span> filter<span class="token operator">:</span> <span class="token string">'3'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> userAccess <span class="token operator">=</span> req<span class="token punctuation">.</span>user<span class="token punctuation">.</span>access <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> search <span class="token operator">=</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'in'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
search <span class="token operator">=</span> Access<span class="token punctuation">.</span><span class="token function">addAccessibleToSearch</span><span class="token punctuation">(</span>search<span class="token punctuation">,</span> userAccess<span class="token punctuation">,</span> <span class="token string">'coffee'</span><span class="token punctuation">,</span> <span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Filtered search:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">'in'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'2'</span><span class="token punctuation">]</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span>
</code></pre></div><h2 id="find"><a href="#find" class="header-anchor">#</a> find</h2> <h3 id="overview-6"><a href="#overview-6" class="header-anchor">#</a> Overview</h3> <div class="language- extra-class"><pre><code>This is intended for searching access. it translations directly to [TheWall](https://www.npmjs.com/package/thewall) `findAccess` function.
</code></pre></div><h3 id="parameter-5"><a href="#parameter-5" class="header-anchor">#</a> Parameter</h3> <ul><li>access: javascript object indicating what should be searched. Similar to the <code>search</code> parameter of <a href="/models/find.html#parameters">The Model</a>.</li></ul> <h3 id="return-value-5"><a href="#return-value-5" class="header-anchor">#</a> Return value</h3> <ul><li>accesses: Array of javascript object. Where each javascript object represents a role.</li></ul> <h3 id="examples-4"><a href="#examples-4" class="header-anchor">#</a> Examples</h3> <p>If you want to search for all the accesses/roles of the user with id=1:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Access<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> user_id<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>To find all the users who have coffeeDrinker role on coffee 4.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Access<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> role<span class="token operator">:</span> <span class="token string">'coffeeDrinker'</span><span class="token punctuation">,</span> filter<span class="token operator">:</span> <span class="token string">'4'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="hasaccessto"><a href="#hasaccessto" class="header-anchor">#</a> hasAccessTo</h2> <h3 id="overview-7"><a href="#overview-7" class="header-anchor">#</a> Overview</h3> <p>It will indicate if the given user has or not access to the requested id. This is equivalent to asking, does the user have a role with access to the requested filter?</p> <h3 id="parameter-6"><a href="#parameter-6" class="header-anchor">#</a> Parameter</h3> <ul><li>user: javascript object representing the requesting user. It should hold the TheWall roles in an <code>access</code> property.</li> <li>to: The subdivision/module at issue.</li> <li>filterId: the given specific filter being asked.</li></ul> <div class="custom-block tip"><p class="custom-block-title">Common Use</p> <p>The most common way of using this method is by passing the <code>req.user</code> property as the <code>user</code> parameter. Note that this property is added by the middleware and if this latter is not configured correctly, particularly the <code>Middleware.prerouting(app)</code> is missing, the <code>req.user</code> property will be absent.</p></div> <h3 id="return-value-6"><a href="#return-value-6" class="header-anchor">#</a> Return value</h3> <ul><li>hasAccess: Boolean indicating if the user has access to the filterId of that subdivision/module.</li></ul> <h3 id="examples-5"><a href="#examples-5" class="header-anchor">#</a> Examples</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code>req<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token punctuation">{</span>id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> access<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> role<span class="token operator">:</span> <span class="token string">'coffeeAdmin'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
Access<span class="token punctuation">.</span><span class="token function">hasAccessTo</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>user<span class="token punctuation">,</span> <span class="token string">'coffee'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns true</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code>req<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token punctuation">{</span>id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> access<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> role<span class="token operator">:</span> <span class="token string">'coffeeDrinker'</span><span class="token punctuation">,</span> filter<span class="token operator">:</span> <span class="token string">'2'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
Access<span class="token punctuation">.</span><span class="token function">hasAccessTo</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>user<span class="token punctuation">,</span> <span class="token string">'coffee'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns true</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code>req<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token punctuation">{</span>id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> access<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> role<span class="token operator">:</span> <span class="token string">'coffeeDrinker'</span><span class="token punctuation">,</span> filter<span class="token operator">:</span> <span class="token string">'2'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
Access<span class="token punctuation">.</span><span class="token function">hasAccessTo</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>user<span class="token punctuation">,</span> <span class="token string">'coffee'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns false</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code>req<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token punctuation">{</span>id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> access<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> role<span class="token operator">:</span> <span class="token string">'coffeeDrinker'</span><span class="token punctuation">,</span> filter<span class="token operator">:</span> <span class="token string">'2'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
Access<span class="token punctuation">.</span><span class="token function">hasAccessTo</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>user<span class="token punctuation">,</span> <span class="token string">'tea'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns false</span>
</code></pre></div><h2 id="generatetoken"><a href="#generatetoken" class="header-anchor">#</a> generateToken</h2> <h3 id="overview-8"><a href="#overview-8" class="header-anchor">#</a> Overview</h3> <p>It will generate an access token for the given user. It will expire in 7 days.</p> <h3 id="parameter-7"><a href="#parameter-7" class="header-anchor">#</a> Parameter</h3> <ul><li>user: javascript object representing the user.</li></ul> <h3 id="return-value-7"><a href="#return-value-7" class="header-anchor">#</a> Return value</h3> <ul><li>accessToken: Javascript object with two properties. The token, as an encrypted string, and the expiration.</li></ul> <h3 id="example-2"><a href="#example-2" class="header-anchor">#</a> Example</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code>req<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token punctuation">{</span>id<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
Access<span class="token punctuation">.</span><span class="token function">generatToken</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns true</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span> token<span class="token operator">:</span>
 <span class="token string">'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoxLCJpYXQiOjE1OTYzODY0MDQsImV4cCI6MTU5Njk5MTIwNH0.UssIWi2QgutT3IKR4WImW7WTHpOi518hEgMW7mIHyi4'</span><span class="token punctuation">,</span>
expiration<span class="token operator">:</span> <span class="token string">'2020-08-09T16:40:04.789Z'</span> 
<span class="token punctuation">}</span>
</code></pre></div><h2 id="token-encryption"><a href="#token-encryption" class="header-anchor">#</a> Token Encryption</h2> <div class="custom-block danger"><p class="custom-block-title">WARNING</p> <p>This is <strong>VERY IMPORTANT</strong>: The token is a jsonwebtoken encrypted by the <a href="https://en.wikipedia.org/wiki/Environment_variable" target="_blank" rel="noopener noreferrer">environment variable<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <code>JWT_SECRET</code>. You must define your own <code>JWT_SECRET</code> that must be kept confidential. If this variable is not defined, Chinchay will use a default secret, this will make your app prone to cyber-attacks.</p></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/middleware/middleware.html">
        Middleware
      </a>
      
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.2773cf3e.js" defer></script><script src="/assets/js/2.3f720234.js" defer></script><script src="/assets/js/25.6f8b54bd.js" defer></script>
  </body>
</html>
